;/*FB_PKG_DELIM*/

__d("MStoriesFlyout",["MStoriesGating","MStoriesStratcomEvents","MStoriesUtils","Stratcom"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){var b=this;this.$3=function(){b.$1.destroy()};this.$1=a;this.$2=[]}var b=a.prototype;b.enable=function(){var a=this;this.$2=[c("Stratcom").listen(d("MStoriesStratcomEvents").VIEWER_SHEET_HIDE,null,function(){d("MStoriesGating").shouldShowNTViewerSheet()?window.setTimeout(function(){a.$1.hide()},500):a.$1.hide()}),c("Stratcom").listen(d("MStoriesStratcomEvents").DELETE_THREAD,null,this.$3)];this.$2=this.$2.concat(d("MStoriesUtils").listenForThreadTransition(this.$3))};b.disable=function(){this.$2.forEach(function(a){return a.remove()}),this.$2=[]};return a}();g["default"]=a}),98);
__d("XMStoriesAsyncBucketViewerController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/stories/story/{bucket_id}/",{bucket_id:{type:"FBID",required:!0},bucket_index:{type:"Int"},last_seen_thread_id:{type:"FBID"},optimistic_media_ids:{type:"FBIDVector"},tray_session_id:{type:"String"},viewer_session_id:{type:"String"},prev_bucket_index:{type:"Int"},source:{type:"String"},unseen_mode:{type:"Bool",defaultValue:!1},upload_count:{type:"Int"},tracking_string:{type:"String"}})}),null);
__d("MStoriesMultiStoryViewer",["CloseStoryGesture","FBLogger","MStoriesBucketViewer","MStoriesDisplayUtils","MStoriesGating","MStoriesLoggingUtils","MStoriesOptimisticInfo","MStoriesSessionInfo","MStoriesStratcomEvents","MStoriesTrackableElements","MStoriesTrayInfo","MStoriesUtils","QuickPerformanceLogger","Run","StoryNavigationGesture","Stratcom","ThisControllerNoLongerExists","URI","XAsyncRequest","XMStoriesAsyncBucketViewerController","nullthrows","qpl"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){var b=this;this.$11=function(a){a=!!a.getData().backwards;b.$2.splice(b.$1,1);a&&b.$1>0?b.$9():!a&&(b.$1<b.$2.length||b.$4&&b.$4.hasNextPage())?(b.$1--,b.$10()):b.$14(c("StoryNavigationGesture").AUTO_JUMP)};this.$12=function(a){a=new(c("URI"))(a.getData().path);a=a.getPath();if(a.startsWith("/stories")||a.startsWith("/direct"))return;b.$15(c("CloseStoryGesture").BACK_BUTTON_EXIT)};this.$19=function(a,c){b.$2=b.$2.concat(a),b.$8=b.$8.concat(c)};this.$13=function(){c("QuickPerformanceLogger").markerEnd(c("qpl")._(13238354,"1306"),4),b.$5.forEach(function(a){return a.remove()}),d("MStoriesLoggingUtils").resetCanLogCloseStoryExit(),d("MStoriesSessionInfo").setFeedUnitTrackingString(null)};this.$20=function(a){c("QuickPerformanceLogger").markerEnd(c("qpl")._(13238354,"1306"),3),b.$3=null};this.$18=function(a,e){a=(a=a)!=null?(a=a.payload)!=null?a.goToHomepage:a:a;a?b.$14(e||c("StoryNavigationGesture").AUTO_JUMP):d("MStoriesDisplayUtils").toggleLoadingScreen(!1,!0);b.$3=null};var e=a.selectedBucketID,f=a.bucketIDs,g=a.paginator,h=a.traySessionID,i=a.viewerSessionID,j=a.unseenMode,k=a.exitUri,l=a.source,m=a.storyViewerType,n=a.feedUnitID;a=a.feedUnitTrackingString;d("MStoriesUtils").setExitUri(k);l&&d("MStoriesSessionInfo").setSource(l);h&&d("MStoriesSessionInfo").setTraySessionID(h);i&&d("MStoriesSessionInfo").setViewerSessionID(i);a&&d("MStoriesSessionInfo").setFeedUnitTrackingString(a);n&&d("MStoriesSessionInfo").setFeedUnitID(n);f.length>0?this.$2=f:this.$2=[].concat(d("MStoriesTrayInfo").getTrayBucketIDs(n));this.$8=[].concat(d("MStoriesTrayInfo").getTrayTrackingStrings(n));this.$1=this.$2.indexOf(e);this.$4=g;this.$6=!!j;this.$7=m;this.$5=[c("Stratcom").listen(d("MStoriesStratcomEvents").PREV_BUCKET,null,function(a){a=a.getData()||{};b.$9(a.gesture)}),c("Stratcom").listen(d("MStoriesStratcomEvents").NEXT_BUCKET,null,function(a){a=a.getData()||{};b.$10(a.gesture)}),c("Stratcom").listen(d("MStoriesStratcomEvents").DELETE_BUCKET,null,this.$11),c("Stratcom").listen(d("MStoriesStratcomEvents").MUTE_BUCKET,null,this.$11),c("Stratcom").listen("m:history:change",null,this.$12),c("Stratcom").listen(d("MStoriesStratcomEvents").SET_BUCKET_IDS_USE_FOR_TESTING_ONLY,null,function(a){a=a.getData()||{};b.$2=a.bucketIDs;b.$1=a.bucketIndex})];d("MStoriesLoggingUtils").resetCanLogCloseStoryExit();d("Run").onLeave(this.$13)}var b=a.prototype;b.$9=function(a){if(this.$3)return;a=a||c("StoryNavigationGesture").AUTO_JUMP;d("MStoriesLoggingUtils").logStoryNavigation(c("MStoriesBucketViewer").getInstance().getInsightsLoggingData(),a);this.$1>0?(this.$16(a,!1),this.$17(!1)):this.$14(a)};b.$10=function(a){var b=this;if(this.$3)return;var e=a||c("StoryNavigationGesture").AUTO_JUMP;d("MStoriesLoggingUtils").logStoryNavigation(c("MStoriesBucketViewer").getInstance().getInsightsLoggingData(),e);this.$1<this.$2.length-1?(this.$16(e,!1),this.$17(!0)):this.$4&&this.$4.hasNextPage()?(this.$16(e,!1),d("MStoriesTrackableElements").hideElementsAndInvokeLogging(),d("MStoriesDisplayUtils").toggleLoadingScreen(!0,!0),this.$1++,this.$3=c("nullthrows")(this.$4).getNextPage(function(a){return b.$18(a,e)},function(){b.$1--,b.$18(null,e)},this.$19)):this.$14(e)};b.$16=function(a,b){this.$15(c("StoryNavigationGesture").getCloseStoryGestureFromStoryNavigation(a,b))};b.$15=function(a){d("MStoriesLoggingUtils").logCloseStory(c("MStoriesBucketViewer").getInstance().getInsightsLoggingData(),a)};b.$14=function(a){this.$16(a,!0),d("MStoriesUtils").goBackToHomepage(this.$7==="highlight")};b.$17=function(a){c("QuickPerformanceLogger").markerEnd(c("qpl")._(13238354,"1306"),4);c("QuickPerformanceLogger").markerStart(c("qpl")._(13238354,"1306"));var b=this.$1;this.$1+=a?1:-1;a=this.$2[this.$1];a==null&&c("FBLogger")("fbstories").warn("Bucket id is null: %s %s",this.$1,this.$2.join());var e=c("MStoriesBucketViewer").getInstance().getLastSeenThreadIdForBucketId(a);d("MStoriesTrackableElements").hideElementsAndInvokeLogging();d("MStoriesDisplayUtils").toggleLoadingScreen(!0,!0);var f=null;if(d("MStoriesGating").shouldShowOptimisticPreviews()){var g=d("MStoriesOptimisticInfo").getFirstUnseenUpload();if(g)f=g;else{g=c("MStoriesBucketViewer").getInstance().getLastSeenOptimisticThreadIdForBucketId(a);g&&(f=d("MStoriesOptimisticInfo").getUploadForThreadID(g))}}f?g=d("ThisControllerNoLongerExists").__DEADURI__("cufc0c9lp"):g=c("XMStoriesAsyncBucketViewerController").getURIBuilder().setFBID("bucket_id",a.toString()).setInt("bucket_index",this.$1).setInt("prev_bucket_index",b).setFBID("last_seen_thread_id",e).setString("tray_session_id",d("MStoriesSessionInfo").getTraySessionID()).setString("viewer_session_id",d("MStoriesSessionInfo").getViewerSessionID()).setFBIDVector("optimistic_media_ids",d("MStoriesOptimisticInfo").getMediaIDs()).setString("source",d("MStoriesSessionInfo").getSource()).setBool("unseen_mode",this.$6).setInt("upload_count",d("MStoriesOptimisticInfo").nonCompletedUploadCount()).setString("tracking_string",this.$8[this.$1]).getURI();this.$3=new(c("XAsyncRequest"))(g).setHandler(this.$18).setErrorHandler(this.$20);this.$3.send()};b.getBucketIndex=function(){return this.$1};b.getUnseenMode=function(){return this.$6};return a}();g["default"]=a}),98);
__d("MStoriesNUX",["invariant","DOM","MRequest","MStoriesStratcomEvents","Stratcom","XBasicFBNuxDismissController"],(function(a,b,c,d,e,f,g){a={_nuxDOM:HTMLElement,_nuxID:null,init:function(a,c){this._nuxDOM=a,this._nuxID=c,b("Stratcom").listen(["click","touchmove"],null,this._onDismiss.bind(this)),b("Stratcom").invoke(b("MStoriesStratcomEvents").MEDIA_PAUSE,null)},_onDismiss:function(){b("Stratcom").removeCurrentListener();this._nuxID||g(0,5379);b("Stratcom").invoke(b("MStoriesStratcomEvents").MEDIA_PLAY,null);b("DOM").hide(this._nuxDOM);var a=b("XBasicFBNuxDismissController").getURIBuilder().setInt("nux_id",this._nuxID).getURI();new(b("MRequest"))(a).send()}};e.exports=a}),null);
__d("XMStoriesAsyncTrayViewerPaginationController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/stories/tray/viewer/nextPage/",{bucket_index:{type:"Int"},source:{type:"String"},start_cursor:{type:"String",required:!0},tray_session_id:{type:"String"},unseen_mode:{type:"Bool",defaultValue:!1},viewer_session_id:{type:"String"}})}),null);
__d("MStoriesTrayViewer",["MStoriesMultiStoryViewer","MStoriesSessionInfo","MStoriesTrayInfo","XAsyncRequest","XMStoriesAsyncTrayViewerPaginationController"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){this.$3=new(c("MStoriesMultiStoryViewer"))(babelHelpers["extends"]({},a,{paginator:this}));var b=a.bucketIDs,e=a.endCursor,f=a.feedUnitID;a=a.hasNextPage;this.$1=e;b.length>0?this.$2=a:this.$2=d("MStoriesTrayInfo").getHasNextPage(f)}var b=a.prototype;b.getNextPage=function(a,b,e){var f=this,g=c("XMStoriesAsyncTrayViewerPaginationController").getURIBuilder().setString("start_cursor",this.$1).setInt("bucket_index",this.$3.getBucketIndex()).setString("source",d("MStoriesSessionInfo").getSource()).setBool("unseen_mode",this.$3.getUnseenMode()).getURI();g=new(c("XAsyncRequest"))(g).setHandler(a).setErrorHandler(b).setPayloadHandler(function(a){f.$4(a,e)});g.send();return g};b.$4=function(a,b){if(!a)return;var c=a.bucket_ids,d=a.end_cursor,e=a.has_next_page;a=a.trackingStrings;this.$1=d;this.$2=e;b(c,a)};b.hasNextPage=function(){return this.$2};return a}();g["default"]=a}),98);
__d("MStoriesViewerSheetImageList",["CSS","Event","MStoriesStratcomEvents","MStoriesUtils","MStoriesViewerSheetThreadRelatedInfo","Run","Stratcom"],(function(a,b,c,d,e,f,g){"use strict";var h=200,i=500,j=92;a=function(){a.init=function(){var b=a.getInstance();this.$1=b};a.getInstance=function(){this.$1||(this.$1=new a());return this.$1};function a(){var b=this;this.$3=[];this.$4=[];this.$5=null;this.$6=null;this.$7=null;this.$8=null;this.$14=function(){window.clearTimeout(b.$5),b.$5=window.setTimeout(b.updateImageListPositionAndNTByCurrentThreadIndex,i)};this.updateImageListPositionAndNTByCurrentThreadIndex=function(){var a=b.$6;if(!a)return;var e=d("MStoriesViewerSheetThreadRelatedInfo").getCurrentThreadIndex();b.$16()!==a.getScrollLeft()&&a.animatedScrollTo(j*e,0,h);d("MStoriesViewerSheetThreadRelatedInfo").getCurrentNTIndex()!==e&&(d("MStoriesViewerSheetThreadRelatedInfo").setCurrentNTIndex(e),c("Stratcom").invoke(d("MStoriesStratcomEvents").VIEWER_SHEET_NATIVE_TEMPLATE_CHANGED_BY_SCROLLING))};this.$13=function(){b.$3.forEach(function(a){return a.remove()}),b.$4.forEach(function(a){return a.remove()}),b.$4=[],b.$3=[],a.$1=null};this.$3=[c("Stratcom").listen("MScrollArea:create",null,function(a){b.$9(a),b.$10(a)}),c("Stratcom").listen("MScrollArea:scrollend",null,function(a){return b.$11(a)}),c("Stratcom").listen("MScrollArea:scroll",null,function(a){b.$12(a)}),c("Stratcom").listen(d("MStoriesStratcomEvents").DELETE_THREAD,null,this.$13)];d("MStoriesUtils").listenForThreadTransition(this.$13);d("Run").onLeave(this.$13)}var b=a.prototype;b.$10=function(a){if(a.getData().element.id!=="m-stories-viewer-sheet-image-list-scrollarea")return;this.$6=a.getData().scrollarea;this.$2=a.getData().element;this.$4.concat(c("Event").listen(this.$2,"touchend",this.$14));d("MStoriesViewerSheetThreadRelatedInfo").setCurrentNTIndex(d("MStoriesViewerSheetThreadRelatedInfo").getCurrentThreadIndex());this.updateImageListPositionAndNTByCurrentThreadIndex()};b.$9=function(a){if(a.getData().element.id!=="m-stories-viewer-sheet-native-template-scrollarea")return;this.$7=a.getData().scrollarea};b.$12=function(a){a=a.getData();if(!a.scrolledByUser||a.element.id!=="m-stories-viewer-sheet-image-list-scrollarea")return;this.$6=a.scrollarea;this.$15()};b.$11=function(a){var b=a.getData();if(!b.scrolledByUser)return;this.$9(a);if(b.element.id!=="m-stories-viewer-sheet-image-list-scrollarea")return;this.$6=b.scrollarea;this.$15()};b.$16=function(){return d("MStoriesViewerSheetThreadRelatedInfo").getCurrentThreadIndex()*j};b.$15=function(){if(this.$6==null)return;var a=this.$6.getScrollPageIndex();a=Math.min(d("MStoriesViewerSheetThreadRelatedInfo").getMaxThreadIndex(),a);a!==d("MStoriesViewerSheetThreadRelatedInfo").getCurrentThreadIndex()&&(d("MStoriesViewerSheetThreadRelatedInfo").setCurrentThreadIndex({currentThreadIndex:a}),c("Stratcom").invoke(d("MStoriesStratcomEvents").VIEWER_SHEET_IMAGE_CHANGED_BY_SCROLLING))};b.scrollNativeTemplateToTop=function(){this.$7&&this.$7.scrollToTop(!1)};b.$17=function(){this.$8||(this.$8=document.getElementById("m-stories-viewer-sheet-spinner"));return this.$8};b.toggleSpinner=function(a){var b=this.$17();if(!b)return;a?c("CSS").removeClass(b,"hidden_elem"):c("CSS").addClass(b,"hidden_elem")};return a}();a.$1=null;g["default"]=a}),98);
__d("MStoriesViewerSheet",["cx","CSS","MStoriesGating","MStoriesLoggingUtils","MStoriesSessionInfo","MStoriesStratcomEvents","MStoriesUtils","MStoriesViewerSheetImageList","Run","Stratcom","nullthrows","uuidv4"],(function(a,b,c,d,e,f,g,h){"use strict";a=function(){a.init=function(b){var c=a.getInstance();c.$4=b.cardID;c.$5=b.newViewerCount;c.$6=b.viewerCount};a.getInstance=function(){this.$1||(this.$1=new a());return this.$1};function a(){var b=this;this.$3=null;this.$5=0;this.$6=0;this.$9=function(){d("MStoriesSessionInfo").setViewerSheetSessionID(c("uuidv4")());d("MStoriesSessionInfo").getTraySessionID()==null&&d("MStoriesSessionInfo").setTraySessionID(c("uuidv4")());d("MStoriesLoggingUtils").logWithFalco({card_id:c("nullthrows")(b.$4),name:"open_seen_summary",number_viewers:b.$6,new_viewer_count:b.$5,viewer_sheet_open_source:"default_self_story"});if(!d("MStoriesGating").shouldShowNTViewerSheet())return;var a=b.$7(),e=b.$11(a);window.setTimeout(function(){c("MStoriesViewerSheetImageList").getInstance().updateImageListPositionAndNTByCurrentThreadIndex(),e&&c("CSS").removeClass(e,"hide")},20)};this.$10=function(){b.$2.forEach(function(a){return a.remove()}),b.$2=[],a.$1=null};this.$2=[c("Stratcom").listen(d("MStoriesStratcomEvents").VIEWER_SHEET_HIDE,null,function(){var a=b.$7();a&&c("CSS").addClass(a,"_6q73");b.$8(a);c("Stratcom").invoke(d("MStoriesStratcomEvents").VIEWER_SHEET_HIDDEN,null)}),c("Stratcom").listen("click","m-stories-viewer-seen-summary-anchor",this.$9),c("Stratcom").listen(d("MStoriesStratcomEvents").DELETE_THREAD,null,this.$10)];d("MStoriesUtils").listenForThreadTransition(this.$10);d("Run").onLeave(this.$10)}var b=a.prototype;b.$7=function(){this.$3||(this.$3=document.getElementById("m-stories-viewer-sheet-root"));return this.$3};b.$8=function(a){if(!d("MStoriesGating").shouldShowNTViewerSheet())return;a=this.$11(a);a&&c("CSS").addClass(a,"hide")};b.$11=function(a){return a==null?void 0:(a=a.parentElement)==null?void 0:(a=a.parentElement)==null?void 0:(a=a.parentElement)==null?void 0:a.parentElement};return a}();a.$1=null;g["default"]=a}),98);